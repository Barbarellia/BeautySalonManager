@page "{id:int?}/{employeeId:int?}/{month?}/{day:int?}"
@model BeautySalonManager.Pages.Treatments.IndexModel

@{
    ViewData["Title"] = "Zabiegi";
}

<h2>Zabiegi</h2>

<p>
    <a asp-page="Create">Dodaj zabieg</a>
</p>
<div asp-validation-summary="ModelOnly" class="alert alert-success fade in">
    <a class="close" data-dismiss="alert" aria-label="close">&times;</a>
</div>

<div class="panel-group" id="accordion">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">Paznokcie</a>
            </h4>
        </div>
        <div id="collapse1" class="panel-collapse collapse in">
            <div class="panel-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nazwa</th>
                            <th>Czas trwania</th>
                            <th>Cena</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Treatment.Treatments)
                        {
                            if (item.Category == 1)
                            {
                                string selectedRow = "";
                                if (item.Id == Model.TreatmentID)
                                {
                                    selectedRow = "success";
                                }
                                <tr class="@selectedRow">
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Name)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Duration)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Price)
                                    </td>
                                    <td>
                                        <a asp-page="./Index" asp-route-id="@item.Id">Wybierz</a> |
                                        <a asp-page="./Edit" asp-route-id="@item.Id">Edytuj</a> |
                                        <a asp-page="./Details" asp-route-id="@item.Id">Szczegóły</a> |
                                        <a asp-page="./Delete" asp-route-id="@item.Id">Usuń</a>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">Rzęsy/brwi</a>
            </h4>
        </div>
        <div id="collapse2" class="panel-collapse collapse">
            <div class="panel-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nazwa</th>
                            <th>Czas trwania</th>
                            <th>Cena</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Treatment.Treatments)
                        {
                            if (item.Category == 2)
                            {
                                string selectedRow = "";
                                if (item.Id == Model.TreatmentID)
                                {
                                    selectedRow = "success";
                                }
                                <tr class="@selectedRow">
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Name)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Duration)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Price)
                                    </td>
                                    <td>
                                        <a asp-page="./Index" asp-route-id="@item.Id">Wybierz</a> |
                                        <a asp-page="./Edit" asp-route-id="@item.Id">Edytuj</a> |
                                        <a asp-page="./Details" asp-route-id="@item.Id">Szczegóły</a> |
                                        <a asp-page="./Delete" asp-route-id="@item.Id">Usuń</a>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">Ciało</a>
            </h4>
        </div>
        <div id="collapse3" class="panel-collapse collapse">
            <div class="panel-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nazwa</th>
                            <th>Czas trwania</th>
                            <th>Cena</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Treatment.Treatments)
                        {
                            if (item.Category == 3)
                            {
                                string selectedRow = "";
                                if (item.Id == Model.TreatmentID)
                                {
                                    selectedRow = "success";
                                }
                                <tr class="@selectedRow">
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Name)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Duration)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Price)
                                    </td>
                                    <td>
                                        <a asp-page="./Index" asp-route-id="@item.Id">Wybierz</a> |
                                        <a asp-page="./Edit" asp-route-id="@item.Id">Edytuj</a> |
                                        <a asp-page="./Details" asp-route-id="@item.Id">Szczegóły</a> |
                                        <a asp-page="./Delete" asp-route-id="@item.Id">Usuń</a>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapse4">Twarz</a>
            </h4>
        </div>
        <div id="collapse4" class="panel-collapse collapse">
            <div class="panel-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nazwa</th>
                            <th>Czas trwania</th>
                            <th>Cena</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Treatment.Treatments)
                        {
                            if (item.Category == 4)
                            {
                                string selectedRow = "";
                                if (item.Id == Model.TreatmentID)
                                {
                                    selectedRow = "success";
                                }
                                <tr class="@selectedRow">
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Name)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Duration)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Price)
                                    </td>
                                    <td>
                                        <a asp-page="./Index" asp-route-id="@item.Id">Wybierz</a> |
                                        <a asp-page="./Edit" asp-route-id="@item.Id">Edytuj</a> |
                                        <a asp-page="./Details" asp-route-id="@item.Id">Szczegóły</a> |
                                        <a asp-page="./Delete" asp-route-id="@item.Id">Usuń</a>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@if (Model.Treatment.Employees != null)
{
    <h3>Dostępni pracownicy</h3>
    <table class="table">
        <tr>
            <th></th>
            <th>Imię</th>
            <th>Nazwisko</th>
            <th>Adres email</th>
        </tr>

        @foreach (var item in Model.Treatment.Employees)
        {
            string selectedRow = "";
            if (item.Id == Model.EmployeeID)
            {
                selectedRow = "success";
            }
            <tr class="@selectedRow">
                <td>
                    <a asp-page="./Index" asp-route-employeeId="@item.Id">Wybierz</a>
                </td>
                <td>
                    @item.User.LastName
                </td>
                <td>
                    @item.User.FirstName
                </td>
                <td>
                    @item.User.Email
                </td>
            </tr>
        }
    </table>

    @if (Model.EmployeeID != 0)
    {
        <h3>Dostępne terminy</h3>
        <hr />
        <div class="row">
            <div class="col-md-4">
                @foreach (var item in Model.MonthsNavigation)
                {
                    string selectedMonth = "default";
                    if (item.Item2 == Model.SelectedMonth)
                    {
                        selectedMonth = "success";
                    }
                    <a class="btn btn-@selectedMonth" asp-page="./Index" asp-route-month="@item.Item2">@item.Item2</a>
                }
                @if (Model.SelectedMonthDaysNumber > 0)
                {
                    for (int i = 0; i < Model.SelectedMonthDaysNumber; i++)
                    {
                        string selectedDay = "default";
                        string disabled = "";
                        if (i + 1 < DateTime.Now.Day && DateTime.Now.Month == Model.SelectedMonthInt)
                        {
                            disabled = "disabled";
                        }
                        else if (i + 1 == Model.SelectedDay)
                        {
                            selectedDay = "success";
                        }
                        if (i % 7 == 0)
                        {
                            @:<br />
                        }
                        <a class="btn btn-@selectedDay @disabled" style="width:40px" asp-page="./Index" asp-route-day="@(i + 1)">@(i + 1)</a>
                    }
                }
            </div>
            <div class="col-md-6">
                @if (Model.SelectedDay != 0)
                {
                    if (Model.FreePeriods.Count == 0)
                    {
                        <div class="alert alert-warning">
                            <strong>Brak wolnych terminów!</strong>
                        </div>
                    }
                    else
                    {
                        string itemDate;
                        <div class="list-group">
                            @foreach (var item in Model.FreePeriods)
                            {
                                itemDate = item.ToString("dd.MM.yyyy HH:mm");
                                <a style="width:15%"
                                   class="list-group-item text-center"
                                   asp-page="./ConfirmEnrollment"
                                   asp-route-date="@itemDate"
                                   asp-route-treatmentAssignmentId="@Model.TreatmentAssignmentId"
                                   asp-route-userId="@Model.UserId">
                                    @item.ToString("HH:mm")
                                </a>
                            }
                        </div>
                    }
                }
            </div>
        </div>
    }
}